### ボイスメモ帳 実装計画書 (Webアプリケーション版)

**1. プロジェクト概要**

*   **コンセプト**: 自分だけのオリジナルボイスメモ帳を作る
*   **ターゲット**: 日々忙しい中で、自分の考えや課題を整理したい個人
*   **解決したい課題とその解決策**: メモ帳やノートに書く一手間を減らしたい → 音声による手軽な記録と高精度な文字起こし
*   **利用シーン**: スマホで記録して、手軽に利用したい
*   **利用の流れ**: 起動したらすぐ記録する。記録を小分けにする。将来的にはLLMで小分けにしたデータを分析
*   **類似既存アプリで表現**: notta, ChatGPTのようなメモ・要約機能
*   **なぜあなたがこれを行うのか**: 余計な機能は不要で、シンプルさを追求したい

**2. プロジェクトの目的**
音声を手軽に記録し、その内容を高精度で文字起こしすることで、簡易的なボイスメモ帳として利用できるWebアプリケーションを開発する。

**3. 主要機能**

*   **音声記録**: Webブラウザを通じてマイクからの音声を録音し、サーバーに送信する。
*   **文字起こし**: サーバー側で録音された音声データを高精度でテキストに変換する。高速リアルタイム性よりも、記録データの精度を優先する。
*   **記録開始トリガー**:
    *   手動での記録開始（Webページ上の「記録開始」ボタンの押下）。
    *   設定による自動記録開始（Webページロード時に自動で記録を開始）。
*   **テキスト保存**: 文字起こしされたテキストをサーバー上にファイルとして保存する。
*   **細かく分割**: 記録された音声を細かく（例: 5分程度）分割する機能。

**4. 技術スタック（提案）**

Webアプリケーションとして実装するため、以下のライブラリ・技術を組み合わせて実装を進めます。

*   **バックエンド (サーバーサイド)**:
    *   **Python**: 全体のプログラミング言語。
    *   **Webフレームワーク**: `Flask` または `FastAPI`
        *   理由: 軽量でRESTful APIを簡単に構築でき、小規模なアプリケーションに適しているため。
    *   **音声認識 (文字起こし)**: `SpeechRecognition`
        *   理由: 複数の音声認識エンジン（Google Web Speech API, OpenAI Whisperなど）を統一的なインターフェースで利用できるため。サーバー側で音声ファイルを受け取り処理するのに適しています。
    *   **音声処理**: `pydub` (オプション)
        *   理由: 音声ファイルの分割や形式変換が必要になった場合。
    *   **設定永続化**: `sqlite3` (Python標準) または `json`ファイル
        *   理由: シンプルな設定情報をサーバー側で永続化するため。
    *   **ファイル操作**: Python標準ライブラリ（`os`, `datetime`など）
        *   理由: 録音ファイルの保存やテキストファイルの作成に利用。
*   **フロントエンド (クライアントサイド)**:
    *   **HTML**: Webページの構造定義。
    *   **CSS**: Webページのスタイリング。
    *   **JavaScript**:
        *   ユーザーインターフェースの操作（ボタンクリック、ステータス表示）。
        *   ブラウザでのマイクからの音声録音 (`MediaRecorder` API)。
        *   録音データのサーバーへの送信 (`Fetch` API または `XMLHttpRequest`)。
*   **環境構築**: `pip` (Pythonパッケージ管理)

**5. フェーズごとの実装計画**

**フェーズ1: バックエンドのコア機能 (音声データ受信と文字起こし)**

1.  **環境構築**: 必要なPythonライブラリ (`Flask`/`FastAPI`, `SpeechRecognition`) をインストールする。
2.  **Webサーバーのセットアップ**: `Flask`または`FastAPI`で基本的なWebサーバーを立ち上げる。
3.  **音声アップロードAPI**: クライアントから音声データを受け取るためのAPIエンドポイントを実装する。
4.  **文字起こしモジュール**:
    *   受け取った音声データを一時ファイルとして保存し、`SpeechRecognition`ライブラリを使用して文字起こしを実行する。
    *   文字起こし結果をテキストとしてクライアントに返す。
5.  **テキスト保存**: 文字起こしされたテキストを、日付と時刻を名前に含んだ`.txt`ファイルとしてサーバー上に保存する。

**フェーズ2: フロントエンドの基本UIと音声記録**

1.  **HTMLページの作成**: 記録開始/停止ボタン、ステータス表示、文字起こし結果表示用のHTML要素を定義する。
2.  **JavaScriptでの音声記録**:
    *   ブラウザの`MediaRecorder` APIを使用して、マイクからの音声入力を開始・停止する機能。
    *   録音された音声をBlob形式で取得し、サーバーの音声アップロードAPIに送信する。
3.  **UI連携**:
    *   「記録開始」ボタンクリックで録音開始、録音中はボタンの状態を変更する。
    *   サーバーからの文字起こし結果をWebページに表示する。
4.  **CSSでのスタイリング**: シンプルで使いやすいインターフェースをデザインする。

**フェーズ3: 設定機能と自動記録の実装**

1.  **バックエンドでの設定管理**:
    *   設定（例: 自動記録のON/OFF）を保存・読み込みするためのAPIエンドポイントを実装する（`sqlite3`または`json`ファイルを利用）。
2.  **フロントエンドでの設定UI**:
    *   設定を切り替えるためのUI要素（チェックボックスなど）をWebページに追加する。
    *   設定の変更をバックエンドに送信し、保存する。
3.  **自動記録ロジック**:
    *   Webページロード時にバックエンドから自動記録設定を読み込む。
    *   設定がONであれば、JavaScriptで自動的に音声記録を開始する。
4.  **エラーハンドリング**: サーバー側とクライアント側で、音声記録失敗時や文字起こしエラー時のメッセージ表示など、基本的なエラー処理を実装する。

**6. 決定事項と考慮事項**

*   **文字起こしエンジンの選択と精度/コスト**:
    *   APIキーによる有料API (`Google Cloud Speech-to-Text`, `OpenAI Whisper`など) 利用は可能な設計としつつ、初期実装のデフォルトは`SpeechRecognition`ライブラリの`Google Web Speech API`を使用する。
*   **音声ファイルの転送とサイズ**:
    *   長時間の録音は行わず、**5分**ごとに音声を分割し、フロントエンドで分割された音声を録音中に順次サーバーに転送することで、ファイルサイズと転送負荷を管理する。
*   **サーバーリソース**:
    *   リアルタイム性を優先せず、サーバー側で非同期的に文字起こし処理を実行する。短い録音ファイルに分割することで、サーバーの負荷を分散させる。
*   **ファイル命名規則**:
    *   初期は「日付_時刻.txt」の命名規則を採用する。ユーザーが任意のタイトルを付けられる機能は初期リリースには含めない。
*   **リアルタイム性の要件**:
    *   文字起こし中の進捗状況は、Webソケットなどの技術を用いて「処理中…」「完了」といった簡単な状態変化をリアルタイムにユーザーにフィードバックする。部分的なテキストフィードバックは初期段階では行わない。
*   **セキュリティ**:
    *   保存する**音声データ**の暗号化をアプリケーションレベルで実装する。暗号化のレベルは、誰かがサーバーにアクセスした場合にファイルがパスワードで保護されていれば十分な**一般的なセキュリティレベル**を想定する。また、サーバーとの通信は**HTTPS**を前提とする。
*   **デプロイ**:
    *   デプロイ方法は、**無料で利用でき、操作が直感的なPaaS**（例: Heroku, Renderなど）を検討し、AIが適切な方法を選定する。
*   **バックグラウンドでの動作**:
    *   ブラウザのタブを閉じた際のバックグラウンド録音機能は、初期段階では実装しない。
*   **ユーザー認証・認可**:
    *   初期段階ではユーザー認証・認可機能は実装しない。将来的な拡張として検討する。
*   **過去のメモの閲覧・管理機能**:
    *   初期段階では過去のメモの閲覧・管理機能は実装しないが、保存されたテキストファイルの名前（例: 「2024-07-01_10-30.txt」）だけでも一覧で見られると便利なため、検討する。
*   **設定の保存方法**:
    *   自動記録のON/OFFなどの設定は、シンプルな**JSONファイル**を特別な「設定フォルダ」に保存する。将来的に複数のユーザーが利用する可能性を考慮し、ユーザーごとに初回起動時に設定フォルダを作成する。
*   **アプリの見た目と操作感**:
    *   ボタンの色は録音中は赤、非録音時は緑とする。録音中に、音声が記録されていることを示すインジケーターとして、**録音時間と録音状況を波で表示する。**
    *   Webページの全体的な見た目と雰囲気は、**落ち着いたダークモード**を基調とする。
*   **暗号化された音声データの将来的な利用**:
    *   LLM連携やノート機能で使用する際、暗号化された音声データはソースとして利用し、その解除プロセスは自動的に行われる。
*   **問題発生時の確認方法**:
    *   ユーザーが操作中に気づいたこと（例: 「ボタンを押しても反応がなかった」「エラーメッセージが出た」など）はWeb上でトラブルとして記録する際、**「どのような操作をしたか」「何が起きたか」などの項目があらかじめ用意された入力形式とする。また、操作履歴は内部ログとしても記録する。**アプリ内部で発生した見えないエラーは可能な限り詳細にエラーログとして記録する。加えて、エラーが発生した際には、**ポップアップメッセージで簡潔に「エラーが発生しました」と表示し、その際「マイクが見つかりません」「文字起こしに失敗しました」「サーバーとの通信に問題が発生しました」など、具体的なエラー内容も表示する。**

**7. 今後の拡張機能（将来的な検討）**

*   **優先順位**: まずは「ノート機能」の追加を優先する。
*   **ノート機能**: 文字起こしされたテキストを編集し、**キーワードや内容の傾向によって自動的にタグ付けできる**Webベースのノート機能。
*   **LLM連携**: 文字起こしデータをLLMで分析（例: 記録した音声の内容を、**話題のテーマやアクションアイテムに分類**、要約など）。
*   **外部連携**: 他のアプリケーションやサービスとの連携（例: **Notion, Obsidianなどのメモアプリとテキストを共有**）。

**8. 追加機能の提案（将来的な検討）**

現在の計画書にある機能に加えて、アプリをより便利で使いやすくするために、いくつか機能をご提案させていただきます。これらは将来的な検討事項としてご検討ください。

*   **音声の再生機能**: 録音した音声ファイルを、アプリ内で後から聞き直せるようにする機能です。文字起こし結果と合わせて確認できます。
*   **テキストの検索機能**: 保存された文字起こしテキストの中から、キーワードを入力して目的のメモを素早く見つけられる機能です。
*   **タグ付け/カテゴリ分け機能**: 文字起こしされたテキストに、ユーザー様が自由に「タグ」や「カテゴリ」を付けて、後から管理しやすくする機能です。（「ノート機能」の拡張としても考えられます）
*   **エクスポート機能**: 文字起こしされたテキストを、WordファイルやPDFファイルなど、他の形式で保存できるようにする機能です。
*   **録音の自動一時停止/再開機能**: 音声が途切れた際に自動で録音を一時停止し、再び音声が入ったら自動で録音を再開する機能です。無音部分の記録を省き、より効率的な記録を可能にします。
*   **音声ファイルの一覧表示と削除機能**: 保存された音声ファイルと文字起こしテキストの一覧を画面に表示し、不要になったメモを簡単に削除できるようにする機能です。（これは「過去のメモの閲覧・管理機能」をより具体的にしたものです）